# vector.yaml
sources:
  syslog_input:
    type: syslog
    address: "0.0.0.0:514"
    mode: tcp

transforms:
  sid_to_username:
    type: remap
    inputs: ["syslog_input"]
    source: |
      # Load SID lookup table
      lookup_data = parse_json!(read_file!("/etc/vector/sid-lookup.json"))
      
      # Replace SID with username if it exists
      if exists(.sid) {
        .username = get(lookup_data, [.sid]) ?? "unknown_user"
        del(.sid)
      }

sinks:
  to_loki:
    type: loki
    inputs: ["sid_to_username"]
    endpoint: "http://loki:3100"
    encoding:
      codec: json
    labels:
      service: "hammerspace-syslog"
      environment: "production"

# Enable metrics endpoint for Prometheus
api:
  enabled: true
  address: "0.0.0.0:8686"
  playground: false